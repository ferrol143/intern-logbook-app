{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 21, "column": 0}, "map": {"version":3,"sources":["turbopack:///[project]/src/middleware.ts"],"sourcesContent":["import { NextResponse } from 'next/server';\r\nimport type { NextRequest } from 'next/server';\r\nimport { getToken } from 'next-auth/jwt';\r\n\r\nconst protectedPaths = ['/dashboard'];\r\nconst publicPaths = ['/auth', '/api/auth', '/', '/register', '/login'];\r\n\r\nexport async function middleware(req: NextRequest) {\r\n  const { pathname } = req.nextUrl;\r\n\r\n  console.log('Middleware running for path:', pathname);\r\n\r\n  // Handle CORS preflight requests\r\n  if (req.method === 'OPTIONS') {\r\n    return new NextResponse(null, {\r\n      status: 200,\r\n      headers: {\r\n        'Access-Control-Allow-Origin': process.env.NEXTAUTH_URL || '*',\r\n        'Access-Control-Allow-Methods': 'GET, POST, PUT, DELETE, OPTIONS',\r\n        'Access-Control-Allow-Headers': 'Content-Type, Authorization, X-Requested-With',\r\n        'Access-Control-Allow-Credentials': 'true',\r\n      },\r\n    });\r\n  }\r\n\r\n  // Skip middleware for NextAuth API routes specifically\r\n  if (pathname.startsWith('/api/auth')) {\r\n    return NextResponse.next();\r\n  }\r\n\r\n  // Skip middleware for other public paths (but be more specific)\r\n  const isPublicPath = publicPaths.some((path) => {\r\n    if (path === '/') {\r\n      return pathname === '/'; // Exact match for home page\r\n    }\r\n    return pathname.startsWith(path);\r\n  });\r\n\r\n  if (isPublicPath) {\r\n    console.log('Public path, allowing access:', pathname);\r\n    return NextResponse.next();\r\n  }\r\n\r\n  // Check if the path is protected\r\n  const isProtected = protectedPaths.some((path) => pathname.startsWith(path));\r\n\r\n  if (isProtected) {\r\n    try {\r\n      const token = await getToken({\r\n        req,\r\n        secret: process.env.NEXTAUTH_SECRET,\r\n        cookieName: process.env.NODE_ENV === 'production' \r\n          ? '__Secure-next-auth.session-token' \r\n          : 'next-auth.session-token'\r\n      });\r\n\r\n      console.log('Token found:', !!token, token?.email);\r\n\r\n      if (!token) {\r\n        console.log('No token found, redirecting to login');\r\n        const loginUrl = new URL('/auth/login', req.url);\r\n        return NextResponse.redirect(loginUrl);\r\n      }\r\n\r\n      console.log('Token valid, allowing access to protected route');\r\n    } catch (error) {\r\n      console.error('Error getting token:', error);\r\n      const loginUrl = new URL('/auth/login', req.url);\r\n      return NextResponse.redirect(loginUrl);\r\n    }\r\n  }\r\n\r\n  // Continue with the request\r\n  const response = NextResponse.next();\r\n  addSecurityHeaders(response);\r\n  return response;\r\n}\r\n\r\nfunction addSecurityHeaders(res: NextResponse) {\r\n  res.headers.set('X-Frame-Options', 'DENY');\r\n  res.headers.set('X-Content-Type-Options', 'nosniff');\r\n  res.headers.set('Referrer-Policy', 'strict-origin-when-cross-origin');\r\n  res.headers.set('X-XSS-Protection', '1; mode=block');\r\n}\r\n\r\nexport const config = {\r\n  matcher: [\r\n    /*\r\n     * Match only protected routes and exclude static files\r\n     */\r\n    '/dashboard/:path*',\r\n    '/((?!_next/static|_next/image|favicon.ico|.*\\\\.png$|.*\\\\.jpg$|.*\\\\.jpeg$|.*\\\\.gif$|.*\\\\.svg$).*)',\r\n  ],\r\n};"],"names":[],"mappings":";;;;AAAA;AAAA;AAEA;;;AAEA,MAAM,iBAAiB;IAAC;CAAa;AACrC,MAAM,cAAc;IAAC;IAAS;IAAa;IAAK;IAAa;CAAS;AAE/D,eAAe,WAAW,GAAgB;IAC/C,MAAM,EAAE,QAAQ,EAAE,GAAG,IAAI,OAAO;IAEhC,QAAQ,GAAG,CAAC,gCAAgC;IAE5C,iCAAiC;IACjC,IAAI,IAAI,MAAM,KAAK,WAAW;QAC5B,OAAO,IAAI,6LAAA,CAAA,eAAY,CAAC,MAAM;YAC5B,QAAQ;YACR,SAAS;gBACP,+BAA+B,QAAQ,GAAG,CAAC,YAAY,IAAI;gBAC3D,gCAAgC;gBAChC,gCAAgC;gBAChC,oCAAoC;YACtC;QACF;IACF;IAEA,uDAAuD;IACvD,IAAI,SAAS,UAAU,CAAC,cAAc;QACpC,OAAO,6LAAA,CAAA,eAAY,CAAC,IAAI;IAC1B;IAEA,gEAAgE;IAChE,MAAM,eAAe,YAAY,IAAI,CAAC,CAAC;QACrC,IAAI,SAAS,KAAK;YAChB,OAAO,aAAa,KAAK,4BAA4B;QACvD;QACA,OAAO,SAAS,UAAU,CAAC;IAC7B;IAEA,IAAI,cAAc;QAChB,QAAQ,GAAG,CAAC,iCAAiC;QAC7C,OAAO,6LAAA,CAAA,eAAY,CAAC,IAAI;IAC1B;IAEA,iCAAiC;IACjC,MAAM,cAAc,eAAe,IAAI,CAAC,CAAC,OAAS,SAAS,UAAU,CAAC;IAEtE,IAAI,aAAa;QACf,IAAI;YACF,MAAM,QAAQ,MAAM,CAAA,GAAA,oJAAA,CAAA,WAAQ,AAAD,EAAE;gBAC3B;gBACA,QAAQ,QAAQ,GAAG,CAAC,eAAe;gBACnC,YAAY,sCACR,0BACA;YACN;YAEA,QAAQ,GAAG,CAAC,gBAAgB,CAAC,CAAC,OAAO,OAAO;YAE5C,IAAI,CAAC,OAAO;gBACV,QAAQ,GAAG,CAAC;gBACZ,MAAM,WAAW,IAAI,IAAI,eAAe,IAAI,GAAG;gBAC/C,OAAO,6LAAA,CAAA,eAAY,CAAC,QAAQ,CAAC;YAC/B;YAEA,QAAQ,GAAG,CAAC;QACd,EAAE,OAAO,OAAO;YACd,QAAQ,KAAK,CAAC,wBAAwB;YACtC,MAAM,WAAW,IAAI,IAAI,eAAe,IAAI,GAAG;YAC/C,OAAO,6LAAA,CAAA,eAAY,CAAC,QAAQ,CAAC;QAC/B;IACF;IAEA,4BAA4B;IAC5B,MAAM,WAAW,6LAAA,CAAA,eAAY,CAAC,IAAI;IAClC,mBAAmB;IACnB,OAAO;AACT;AAEA,SAAS,mBAAmB,GAAiB;IAC3C,IAAI,OAAO,CAAC,GAAG,CAAC,mBAAmB;IACnC,IAAI,OAAO,CAAC,GAAG,CAAC,0BAA0B;IAC1C,IAAI,OAAO,CAAC,GAAG,CAAC,mBAAmB;IACnC,IAAI,OAAO,CAAC,GAAG,CAAC,oBAAoB;AACtC;AAEO,MAAM,SAAS;IACpB,SAAS;QACP;;KAEC,GACD;QACA;KACD;AACH"}}]
}